import{r as n,u as ke,a as X,g as U,d as j,b as d,s as Se,j as e,B as u,o as C,q as P,w,c as f,m as R,e as E,f as Ce,h as Ae,i as V,k as Ie,l as W,n as Q,p as Pe,t as Ee}from"./index-D7tVnmx7.js";import{C as B,a as G}from"./card-G-I0PeXl.js";import{A as Me,R as Z,a as De,X as ee,Y as te,T as se,b as Re,L as Fe,B as Le}from"./AreaChart-ChD5yDrG.js";import{B as qe}from"./BarChart-_yvMc_Xd.js";const ae="#3ee0ff",Ue="#8b5cf6",ie=({label:g,value:N})=>e.jsx(B,{className:"bg-[rgba(255,255,255,0.02)] border-[rgba(62,224,255,0.04)]",children:e.jsxs(G,{className:"p-6 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-sm text-white",children:g}),e.jsx("div",{className:"text-3xl font-semibold text-white mt-2",children:N})]})}),Be=n.memo(({section:g,onBack:N,user:m,profile:r,setProfile:M})=>{const[v,k]=n.useState([]),[A,y]=n.useState(null),[b,D]=n.useState([]),[x,ne]=n.useState([]),[T,le]=n.useState([]),[Ge,re]=n.useState([]),[Te,$e]=n.useState([]),[$,oe]=n.useState([]),[F,de]=n.useState(null),[J,Y]=n.useState(!1),[ce,L]=n.useState(!1),[p,S]=n.useState({}),[q,H]=n.useState(null),[K,me]=n.useState(""),[_,ue]=n.useState(""),[he,z]=n.useState(!1);n.useEffect(()=>{r.enteredGrades&&H(r.enteredGrades),r.gradesSubmitted&&z(r.gradesSubmitted)},[r]),n.useEffect(()=>{const t=C(P(f(d,"institutions"),w("status","==","approved")),s=>{k(s.docs.map(i=>({id:i.id,...i.data()})))});return()=>t()},[]),n.useEffect(()=>{const t=C(f(d,"courses"),async s=>{const i=s.docs.map(c=>({id:c.id,...c.data()})),a=v.map(c=>c.id),o=i.filter(c=>a.includes(c.institutionId)),h=await Promise.all(o.map(async c=>{const l=await U(j(d,"institutions",c.institutionId)),I=l.exists()?l.data().name:"Unknown Institution";return{...c,institutionName:I}}));D(h)});return()=>t()},[v]),n.useEffect(()=>{if(!m)return;const t=P(f(d,"registrations"),w("studentId","==",m.uid)),s=C(t,i=>{ne(i.docs.map(a=>({id:a.id,...a.data()})))});return()=>s()},[m]),n.useEffect(()=>{const t=C(P(f(d,"companies"),w("status","==","approved")),async s=>{const i=s.docs.map(o=>o.id),a=C(f(d,"jobs"),o=>{const h=o.docs.map(l=>({id:l.id,...l.data()})).filter(l=>i.includes(l.companyId));le(h);const c=h.filter(l=>{const I=Array.isArray(l.skills)?l.skills:[],Ne=parseFloat(l.marks)||0,ye=I.some(we=>r.skills?.includes(we)),ve=(r.marks||0)>=Ne;return ye&&ve}).map(l=>({...l,type:"job_match"}));re(c)});return()=>a()});return()=>t()},[r]),n.useEffect(()=>{if(!m)return;const t=P(f(d,"notifications"),w("studentId","==",m.uid),w("type","==","interview_invitation")),s=C(t,i=>{const a=i.docs.map(o=>({id:o.id,...o.data()}));oe(o=>[...o.filter(h=>!h.type||h.type!=="interview_invitation"),...a])});return()=>s()},[m]);const O=t=>{if(x.filter(l=>l.institutionId===t.institutionId&&l.type==="course").length>=2)return{eligible:!1,reason:"Max 2 courses per institution reached."};if(x.some(l=>l.courseId===t.id))return{eligible:!1,reason:"Already applied."};if(!q)return{eligible:!1,reason:"Please enter your grades first."};const i=t.requiredSubjects||[],a=t.minMarks||0,o=q.skills||[],h=q.marks||0,c=i.filter(l=>!o.some(I=>I.toLowerCase().trim()===l.toLowerCase().trim()));return c.length>0?{eligible:!1,reason:`Missing skills: ${c.join(", ")}`}:h<a?{eligible:!1,reason:`Marks too low: need ${a}, have ${h}`}:{eligible:!0,reason:""}},xe=async t=>{const s=O(t);if(!s.eligible)return alert(s.reason);if((await U(j(d,"institutions",t.institutionId))).data().published&&x.some(a=>a.status==="admitted"))return alert("Admissions are published. Cannot apply for new courses.");try{await W(f(d,"registrations"),{studentId:m.uid,studentName:r.name,courseId:t.id,courseName:t.name,institutionId:t.institutionId,institutionName:t.institutionName,status:"pending",type:"course",createdAt:Q()}),alert("Applied for course successfully!")}catch(a){console.error(a)}},pe=async t=>{if(x.some(a=>a.jobId===t.id))return alert("Already applied for this job!");const s=Array.isArray(t.skills)?t.skills:[],i=parseFloat(t.marks)||0;if(!s.some(a=>r.skills?.includes(a)))return alert("You do not have the required skills.");if((r.marks||0)<i)return alert("Your marks do not meet the minimum requirement.");try{await W(f(d,"registrations"),{studentId:m.uid,jobId:t.id,jobTitle:t.title,companyId:t.companyId,companyName:t.companyName||"Unknown Company",status:"pending",type:"job",createdAt:Q()}),alert("Job application submitted!")}catch(a){console.error(a)}},be=async t=>{if(!F)return alert("Please select a file!");try{const s=Ce(Ae,`students/${m.uid}/${t}/${F.name}`);return await V(s),alert("File with this name already exists!")}catch{await Ie(fileRef,F);const s=await V(fileRef),i=j(d,"students",m.uid),a=r[t]||[];await E(i,{[t]:[...a,s]}),M(o=>({...o,[t]:[...a,s]})),alert("File uploaded successfully!")}},ge=async()=>{try{await E(j(d,"students",m.uid),p),M(p),L(!1),alert("Profile updated!")}catch(t){console.error(t),alert("Failed to update profile")}},fe=async t=>{const s=x.filter(i=>i.type==="course"&&i.status==="admitted");for(let i of s)if(i.id!==t.id){await E(j(d,"registrations",i.id),{status:"removed"});const a=P(f(d,"registrations"),w("courseId","==",i.courseId),w("status","==","waiting"),Pe("createdAt","asc")),o=await Ee(a);if(!o.empty){const h=o.docs[0];await E(j(d,"registrations",h.id),{status:"pending"})}}Y(!1)},je=()=>{switch(g){case"Dashboard":{const t=[{name:"Courses Applied",count:x.filter(s=>s.type==="course").length},{name:"Jobs Available",count:T.length}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ie,{label:"Courses Applied",value:t[0].count}),e.jsx(ie,{label:"Jobs Available",value:t[1].count})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(B,{className:"bg-[rgba(255,255,255,0.02)] border",children:e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"System Overview"}),e.jsx(Z,{width:"100%",height:200,children:e.jsxs(De,{data:t,children:[e.jsx(ee,{dataKey:"name",stroke:"white",tick:{fill:"white"}}),e.jsx(te,{stroke:"white",tick:{fill:"white"}}),e.jsx(se,{}),e.jsx(Re,{type:"monotone",dataKey:"count",stroke:ae,fill:ae+"22"})]})})]})}),e.jsx(B,{className:"bg-[rgba(255,255,255,0.02)] border",children:e.jsxs(G,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"System Health"}),e.jsx(Z,{width:"100%",height:200,children:e.jsxs(qe,{data:t,children:[e.jsx(ee,{dataKey:"name",stroke:"white",tick:{fill:"white"}}),e.jsx(te,{stroke:"white",tick:{fill:"white"}}),e.jsx(se,{}),e.jsx(Fe,{}),e.jsx(Le,{dataKey:"count",fill:Ue})]})})]})})]}),$.length>0&&e.jsxs("div",{className:"p-4 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-white font-semibold mb-2",children:"Notifications"}),$.map(s=>e.jsx("div",{className:"text-white mb-2 p-2 bg-[rgba(255,255,255,0.01)] rounded",children:s.type==="interview_invitation"?s.message:`${s.title} matches your skills`},s.id))]}),e.jsxs("div",{className:"p-4 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Admission Results"}),x.filter(s=>s.type==="course").map(s=>e.jsxs("div",{className:"text-white mb-2",children:[s.courseName," at ",s.institutionName,": ",s.status]},s.id))]}),x.filter(s=>s.type==="course"&&s.status==="admitted").length>1&&!J&&e.jsxs("div",{className:"p-4 rounded-2xl bg-yellow-600 border",children:[e.jsx("h3",{className:"text-white font-semibold",children:"You are admitted to multiple institutions. Please choose one."}),e.jsx(u,{onClick:()=>Y(!0),className:"mt-2 px-4 py-2 bg-white text-black",children:"Choose Institution"})]}),J&&e.jsxs("div",{className:"p-4 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-white font-semibold mb-4",children:"Choose Your Institution"}),x.filter(s=>s.type==="course"&&s.status==="admitted").map(s=>e.jsxs(u,{onClick:()=>fe(s),className:"mr-2 px-4 py-2 bg-green-600",children:["Choose ",s.institutionName]},s.id))]})]})}case"Institutions":if(A){if(!he)return e.jsxs("div",{children:[e.jsx(u,{onClick:N,variant:"ghost",className:"px-3 py-2 mb-4",children:"← Back to Institutions"}),e.jsxs("div",{className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white mb-4",children:["Enter Your Grades for ",A.name]}),e.jsx("input",{type:"number",placeholder:"Marks",value:K,onChange:s=>me(s.target.value),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white mb-2 w-full"}),e.jsx("input",{type:"text",placeholder:"Skills (comma separated)",value:_,onChange:s=>ue(s.target.value),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white mb-4 w-full"}),e.jsx(u,{onClick:async()=>{const s=parseFloat(K)||0,i=_.split(",").map(a=>a.trim()).filter(a=>a);if(!s||!i.length)alert("Please enter marks and skills.");else{const a={marks:s,skills:i};try{await E(j(d,"students",m.uid),{enteredGrades:a,gradesSubmitted:!0}),H(a),z(!0),alert("Grades submitted successfully!")}catch(o){console.error(o),alert("Failed to submit grades.")}}},className:"px-4 py-2 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] font-semibold",children:"Submit Grades"})]})]});const t=b.filter(s=>s.institutionId===A.id);return e.jsxs("div",{children:[e.jsx(u,{onClick:N,variant:"ghost",className:"px-3 py-2 mb-4",children:"← Back to Institutions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(s=>{const i=x.some(o=>o.courseId===s.id),a=O(s);return e.jsxs(R.div,{whileHover:{scale:1.03},className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:s.name}),e.jsx("p",{className:"text-gray-300 mt-2",children:s.description}),e.jsxs("p",{className:"text-gray-400 mt-1",children:["Required Skills: ",s.requiredSubjects?.join(", ")||"None"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:["Min Marks: ",s.minMarks||0]}),i?e.jsx("div",{className:"mt-4 text-gray-400",children:"Already Applied"}):a.eligible?e.jsx(u,{variant:"ghost",onClick:()=>xe(s),className:"mt-4 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] !text-black",children:"Apply"}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-red-400 text-sm mb-2",children:["Not Eligible: ",a.reason]}),e.jsx(u,{disabled:!0,className:"px-4 py-2 font-semibold bg-gray-500 cursor-not-allowed",children:"Apply"})]})]},s.id)})})]})}return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map(t=>e.jsxs(R.div,{whileHover:{scale:1.03},onClick:()=>y(t),className:"cursor-pointer transition-all hover:bg-[rgba(62,224,255,0.05)] p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border hover:border-[#3ee0ff]",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:t.name}),e.jsx("p",{className:"text-gray-400 mt-2",children:t.description||"No description available"})]},t.id))});case"Jobs":return e.jsx("div",{className:"space-y-4",children:T.map(t=>{const s=x.some(l=>l.jobId===t.id),i=Array.isArray(t.skills)?t.skills:[],a=parseFloat(t.marks)||0,o=i.some(l=>r.skills?.includes(l)),h=(r.marks||0)>=a,c=o&&h;return e.jsxs(R.div,{whileHover:{scale:1.03},className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:t.title}),e.jsx("p",{className:"text-gray-400",children:t.companyName}),e.jsx("p",{className:"text-gray-300 mt-2",children:t.description}),s?e.jsx("div",{className:"mt-4 text-gray-400",children:"Already Applied"}):c?e.jsx(u,{onClick:()=>pe(t),className:"mt-4 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] text-black",children:"Apply"}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-red-400 text-sm mb-2",children:["Not Eligible: ",o?`Marks too low: need ${a}, have ${r.marks||0}`:`Missing skills: ${i.filter(l=>!r.skills?.includes(l)).join(", ")}`]}),e.jsx(u,{disabled:!0,className:"px-4 py-2 font-semibold bg-gray-500 cursor-not-allowed",children:"Apply"})]})]},t.id)})});case"Applications":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Course Applications"}),x.filter(t=>t.type==="course").map(t=>e.jsxs("div",{className:"text-white mb-2 p-4 bg-[rgba(255,255,255,0.01)] rounded",children:[t.courseName," at ",t.institutionName,": ",t.status]},t.id))]}),e.jsxs("div",{className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Job Applications"}),x.filter(t=>t.type==="job").map(t=>e.jsxs("div",{className:"text-white mb-2 p-4 bg-[rgba(255,255,255,0.01)] rounded",children:[t.jobTitle," at ",t.companyName,": ",t.status]},t.id))]})]});case"Uploads":return e.jsx("div",{className:"space-y-6",children:["documents","transcripts"].map(t=>e.jsxs("div",{className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4 capitalize",children:t}),e.jsx("input",{type:"file",onChange:s=>de(s.target.files[0]),className:"mb-3 w-full text-black"}),e.jsx(u,{onClick:()=>be(t),className:"px-4 py-2 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] font-semibold",children:"Upload"})]},t))});case"Profile":return ce?e.jsxs("div",{className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Edit Profile"}),e.jsx("input",{value:p.name||"",onChange:t=>S({...p,name:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white mb-2 w-full",placeholder:"Name"}),e.jsx("input",{value:p.phone||"",onChange:t=>S({...p,phone:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white mb-2 w-full",placeholder:"Phone"}),e.jsx("input",{value:p.location||"",onChange:t=>S({...p,location:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white mb-2 w-full",placeholder:"Location"}),e.jsx("input",{value:p.marks||"",onChange:t=>S({...p,marks:parseFloat(t.target.value)||0}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white mb-2 w-full",placeholder:"Marks",type:"number"}),e.jsx("input",{value:p.skills?.join(", ")||"",onChange:t=>S({...p,skills:t.target.value.split(",").map(s=>s.trim()).filter(s=>s)}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white mb-2 w-full",placeholder:"Skills (comma separated)"}),e.jsx(u,{onClick:ge,className:"px-4 py-2 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] font-semibold mr-2",children:"Save"}),e.jsx(u,{onClick:()=>L(!1),variant:"ghost",className:"px-4 py-2",children:"Cancel"})]}):e.jsxs("div",{className:"p-6 rounded-2xl bg-[rgba(255,255,255,0.02)] border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Profile"}),e.jsx("div",{className:"text-white font-semibold text-lg",children:r.name||"Student Name"}),e.jsx("div",{className:"text-white mt-1",children:r.email||m.email}),e.jsxs("div",{className:"text-white mt-1",children:["Phone: ",r.phone||"N/A"]}),e.jsxs("div",{className:"text-white mt-1",children:["Location: ",r.location||"N/A"]}),e.jsxs("div",{className:"text-white mt-1",children:["Marks: ",r.marks||"N/A"]}),e.jsxs("div",{className:"text-white mt-1",children:["Skills: ",r.skills?.join(", ")||"N/A"]}),e.jsx("button",{onClick:()=>{L(!0),S({...r})},className:"mt-4 px-4 py-2 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] rounded font-semibold",children:"Edit Profile"})]});default:return null}};return e.jsxs(R.div,{layout:!0,initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},children:[g!=="Dashboard"&&e.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[e.jsx(u,{onClick:N,variant:"ghost",className:"px-3 py-2",children:"← Back"}),e.jsx("h2",{className:"text-2xl font-semibold text-white",children:g})]}),je()]})});function _e(){const[g,N]=n.useState("Dashboard"),[m,r]=n.useState(null),[M,v]=n.useState({}),k=ke();n.useEffect(()=>{const y=X.onAuthStateChanged(async b=>{if(!b)return k("/login");if(!b.emailVerified)return k("/verify-email");r(b);const D=await U(j(d,"students",b.uid));D.exists()?v(D.data()):(await Se(j(d,"students",b.uid),{name:b.displayName||"",email:b.email,phone:"",location:"",marks:0,skills:[],documents:[],transcripts:[]}),v({name:b.displayName||"",email:b.email,phone:"",location:"",marks:0,skills:[],documents:[],transcripts:[]}))});return()=>y()},[k]);const A=async()=>{await X.signOut(),k("/login")};return e.jsxs("div",{className:"min-h-screen w-full text-white bg-gradient-to-b from-[#0a0a1a] via-[#0a0a2a] to-black",children:[e.jsxs("aside",{className:"fixed left-0 top-0 h-full w-72 px-6 pt-8 pb-6 border-r hidden md:block",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-2xl font-bold text-white tracking-wide",children:"Student Portal"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Dashboard"})]}),e.jsxs("nav",{className:"space-y-2",children:[["Dashboard","Institutions","Jobs","Applications","Profile"].map(y=>e.jsx(u,{onClick:()=>N(y),variant:g===y?"default":"ghost",className:"w-full justify-start",children:y},y)),e.jsx(u,{onClick:A,variant:"destructive",className:"w-full mt-4",children:"Logout"})]})]}),e.jsx("main",{className:"ml-0 md:ml-72 p-6 pb-24 relative z-10",children:e.jsx(Me,{mode:"wait",children:e.jsx(Be,{section:g,onBack:()=>N("Dashboard"),user:m,profile:M,setProfile:v},g)})})]})}export{_e as default};
