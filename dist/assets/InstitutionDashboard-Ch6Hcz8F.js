import{r as p,u as ie,a as H,j as e,q as j,w as n,c as m,t as y,m as J,B as ne,d as C,b as s,g as O,p as Q,e as I,n as E,l as W}from"./index-D7tVnmx7.js";import{A as re,R as X,a as le,X as Y,Y as z,T as $,b as de,L as oe,B as ce}from"./AreaChart-ChD5yDrG.js";import{B as ue}from"./BarChart-_yvMc_Xd.js";const G="#3ee0ff",me="#8b5cf6";o;const R=({label:w,value:q})=>e.jsxs(J.div,{whileHover:{y:-6},className:"p-4 rounded-2xl bg-[rgba(255,255,255,0.02)] border border-[rgba(62,224,255,0.04)]",children:[e.jsx("div",{className:"text-sm text-gray-300",children:w}),e.jsx("div",{className:"text-xl font-semibold text-white mt-2",children:q})]}),he=({section:w,onBack:q,institutionId:i})=>{const[h,N]=p.useState({}),[k,M]=p.useState([]),[c,T]=p.useState([]),[F,P]=p.useState([]),[V,d]=p.useState(!1),[L,U]=p.useState({name:""}),[r,D]=p.useState({name:"",facultyId:"",requiredSubjects:"",minMarks:0});p.useEffect(()=>{if(!i)return;const a=async()=>{const S=C(s,"institutions",i),v=await O(S);v.exists()&&N(v.data())},t=async()=>{const S=j(m(s,"faculties"),n("institutionId","==",i)),v=await y(S);M(v.docs.map(g=>({id:g.id,...g.data()})))},x=async()=>{const S=j(m(s,"courses"),n("institutionId","==",i)),v=await y(S);T(v.docs.map(g=>({id:g.id,...g.data()})))},b=async()=>{const S=j(m(s,"registrations"),n("institutionId","==",i),Q("createdAt","asc"));let g=(await y(S)).docs.map(l=>({id:l.id,...l.data()}));const u={};g.forEach(l=>{u[l.studentId]||(u[l.studentId]=[]),u[l.studentId].push(l)});for(const l in u){const f=u[l];if(f.length>2)for(let A=2;A<f.length;A++)f[A].status!=="rejected"&&(await I(C(s,"registrations",f[A].id),{status:"rejected"}),f[A].status="rejected")}P(g)};a(),t(),x(),b()},[i]);const Z=async()=>{if(!L.name)return alert("Faculty name required");d(!0);try{const a=j(m(s,"faculties"),n("institutionId","==",i),n("name","==",L.name));if(!(await y(a)).empty){alert("Faculty name already exists"),d(!1);return}await W(m(s,"faculties"),{...L,institutionId:i,createdAt:E()}),U({name:""})}catch(a){console.error(a),alert("Failed to add faculty")}d(!1)},_=async()=>{if(!r.name||!r.facultyId)return alert("Course name and faculty required");d(!0);try{const a=j(m(s,"courses"),n("institutionId","==",i),n("facultyId","==",r.facultyId),n("name","==",r.name));if(!(await y(a)).empty){alert("Course name already exists under this faculty"),d(!1);return}const x=r.requiredSubjects.split(",").map(b=>b.trim()).filter(b=>b);await W(m(s,"courses"),{...r,requiredSubjects:x,institutionId:i,createdAt:E()}),D({name:"",facultyId:"",requiredSubjects:"",minMarks:0})}catch(a){console.error(a),alert("Failed to add course")}d(!1)},ee=async()=>{d(!0);try{await I(C(s,"institutions",i),h),alert("Profile updated!")}catch(a){console.error(a),alert("Failed to update profile")}d(!1)},B=async(a,t)=>{d(!0);try{const x=C(s,"institutions",i);if((await O(x)).data().published&&t!=="admitted"){alert("Admissions are published. Cannot change status from admitted."),d(!1);return}if(await I(C(s,"registrations",a.id),{status:t}),t==="admitted"){const u=j(m(s,"registrations"),n("studentId","==",a.studentId),n("institutionId","!=",i)),l=await y(u);for(let f of l.docs){await I(C(s,"registrations",f.id),{status:"removed"});const A=j(m(s,"registrations"),n("courseId","==",f.data().courseId),n("status","==","waiting")),K=await y(A);if(!K.empty){const ae=K.docs[0];await I(C(s,"registrations",ae.id),{status:"pending"})}}}if(t==="rejected"||t==="removed"){const u=j(m(s,"registrations"),n("courseId","==",a.courseId),n("institutionId","==",i),n("status","==","waiting"),Q("createdAt","asc")),l=await y(u);if(!l.empty){const f=l.docs[0];await I(C(s,"registrations",f.id),{status:"pending"})}}const v=j(m(s,"registrations"),n("institutionId","==",i)),g=await y(v);P(g.docs.map(u=>({id:u.id,...u.data()})))}catch(x){console.error(x),alert("Failed to update student")}d(!1)},te=async()=>{if(confirm("Are you sure you want to publish admissions? This action cannot be undone.")){d(!0);try{await I(C(s,"institutions",i),{published:!0,publishedAt:E()}),alert("Admissions published successfully!")}catch(a){console.error(a),alert("Failed to publish admissions")}d(!1)}},se=()=>{switch(w){case"Dashboard":const a=[{name:"Faculties",count:k.length},{name:"Courses",count:c.length},{name:"Students",count:F.length}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"Faculties",value:k.length}),e.jsx(R,{label:"Courses",value:c.length}),e.jsx(R,{label:"Students",value:F.length})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 rounded-2xl bg-[rgba(255,255,255,0.02)] border border-[rgba(62,224,255,0.04)]",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"System Overview"}),e.jsx(X,{width:"100%",height:200,children:e.jsxs(le,{data:a,children:[e.jsx(Y,{dataKey:"name",stroke:"white",tick:{fill:"white"}}),e.jsx(z,{stroke:"white",tick:{fill:"white"}}),e.jsx($,{}),e.jsx(de,{type:"monotone",dataKey:"count",stroke:G,fill:G+"22"})]})})]}),e.jsxs("div",{className:"p-4 rounded-2xl bg-[rgba(255,255,255,0.02)] border border-[rgba(62,224,255,0.04)]",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"System Health"}),e.jsx(X,{width:"100%",height:200,children:e.jsxs(ue,{data:a,children:[e.jsx(Y,{dataKey:"name",stroke:"white",tick:{fill:"white"}}),e.jsx(z,{stroke:"white",tick:{fill:"white"}}),e.jsx($,{}),e.jsx(oe,{}),e.jsx(ce,{dataKey:"count",fill:me})]})})]})]})]});case"Faculties":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Manage Faculties"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{placeholder:"Faculty Name",value:L.name,onChange:t=>U({name:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white"}),e.jsx("button",{onClick:Z,className:"px-3 py-1 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] rounded font-semibold",children:"Add"})]}),e.jsx("ul",{children:k.map(t=>e.jsx("li",{className:"text-white",children:t.name},t.id))})]});case"Courses":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Manage Courses"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("input",{placeholder:"Course Name",value:r.name,onChange:t=>D({...r,name:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white"}),e.jsxs("select",{value:r.facultyId,onChange:t=>D({...r,facultyId:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white",children:[e.jsx("option",{value:"",children:"Select Faculty"}),k.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("input",{placeholder:"Required Subjects (comma separated)",value:r.requiredSubjects,onChange:t=>D({...r,requiredSubjects:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white"}),e.jsx("input",{placeholder:"Min Marks",type:"number",value:r.minMarks,onChange:t=>D({...r,minMarks:parseFloat(t.target.value)||0}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white"}),e.jsx("button",{onClick:_,className:"px-3 py-1 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] rounded font-semibold",children:"Add"})]}),e.jsx("ul",{children:c.map(t=>{const x=k.find(b=>b.id===t.facultyId);return e.jsxs("li",{className:"text-white",children:[t.name," (",x?.name||"No faculty",") - Req: ",t.requiredSubjects?.join(", ")||"None",", Min Marks: ",t.minMarks||0]},t.id)})})]});case"Students":return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Student Applications"}),!h.published&&e.jsx("button",{onClick:te,className:"px-4 py-2 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] rounded font-semibold",children:"Publish Admissions"}),h.published&&e.jsx("span",{className:"text-green-400 font-semibold",children:"Admissions Published"})]}),e.jsxs("table",{className:"min-w-full text-left divide-y divide-[rgba(255,255,255,0.04)]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-sm text-gray-400",children:[e.jsx("th",{className:"py-3 px-4",children:"Name"}),e.jsx("th",{className:"py-3 px-4",children:"Course"}),e.jsx("th",{className:"py-3 px-4",children:"Status"}),e.jsx("th",{className:"py-3 px-4",children:"Actions"})]})}),e.jsx("tbody",{className:"text-white",children:F.map(t=>{const x=c.find(b=>b.id===t.courseId);return e.jsxs("tr",{className:"hover:bg-[rgba(255,255,255,0.01)]",children:[e.jsx("td",{className:"py-3 px-4",children:t.studentName}),e.jsx("td",{className:"py-3 px-4",children:x?.name||"N/A"}),e.jsx("td",{className:"py-3 px-4",children:t.status}),e.jsxs("td",{className:"py-3 px-4 flex gap-2",children:[e.jsx("button",{onClick:()=>B(t,"admitted"),className:"px-2 py-1 bg-green-600 rounded",children:"Admit"}),e.jsx("button",{onClick:()=>B(t,"rejected"),className:"px-2 py-1 bg-red-600 rounded",children:"Reject"}),e.jsx("button",{onClick:()=>B(t,"pending"),className:"px-2 py-1 bg-yellow-600 rounded",children:"Pending"})]})]},t.id)})})]})]});case"Profile":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Institution Profile"}),e.jsx("input",{value:h.name||"",onChange:t=>N({...h,name:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white",placeholder:"Institution Name"}),e.jsx("input",{value:h.email||"",onChange:t=>N({...h,email:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white",placeholder:"Email"}),e.jsx("input",{value:h.location||"",onChange:t=>N({...h,location:t.target.value}),className:"p-2 rounded bg-[rgba(255,255,255,0.01)] border text-white",placeholder:"Location"}),e.jsx("button",{onClick:ee,className:"px-4 py-2 bg-gradient-to-r from-[#5eead4] to-[#06b6d4] rounded font-semibold",children:V?"Updating...":"Update Profile"})]});default:return null}};return e.jsxs(J.div,{layout:!0,initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},className:"w-full",children:[w!=="Dashboard"&&e.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[e.jsx(ne,{onClick:q,variant:"ghost",className:"px-3 py-2",children:"â† Back"}),e.jsx("h2",{className:"text-2xl font-semibold text-white",children:w})]}),se()]})};function ge(){const[w,q]=p.useState("Dashboard"),[i,h]=p.useState(null),N=ie();p.useEffect(()=>{const c=H.currentUser;c?(async()=>{const F=j(m(s,"institutions"),n("firebaseUid","==",c.uid)),P=await y(F);P.empty?(alert("Institution not found. Please ensure your registration is approved by admin."),N("/login")):h(P.docs[0].id)})():N("/login")},[N]);const k=async()=>{await H.signOut(),N("/login")},M=["Dashboard","Faculties","Courses","Students","Profile"];return e.jsxs("div",{className:"min-h-screen w-full text-white bg-gradient-to-b from-[#0a0a1a] via-[#0a0a2a] to-black",children:[e.jsxs("aside",{className:"fixed left-0 top-0 h-full w-72 px-6 pt-8 pb-6 border-r hidden md:block",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-2xl font-bold text-white tracking-wide",children:"Institution Portal"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Admin Dashboard"})]}),e.jsxs("nav",{className:"space-y-2",children:[M.map(c=>e.jsx("button",{onClick:()=>q(c),className:`w-full text-left px-3 py-2 rounded-lg ${w===c?"bg-[rgba(62,224,255,0.04)]":"hover:bg-[rgba(255,255,255,0.02)]"}`,children:c},c)),e.jsx("button",{onClick:k,className:"w-full text-left px-3 py-2 rounded-lg bg-red-600 hover:bg-red-700 mt-4",children:"Logout"})]})]}),e.jsx("main",{className:"ml-0 md:ml-72 p-6 pb-24 relative z-10",children:e.jsx(re,{exitBeforeEnter:!0,children:e.jsx(he,{section:w,onBack:()=>q("Dashboard"),institutionId:i},w)})})]})}export{ge as default};
